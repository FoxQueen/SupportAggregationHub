package com.fox.main;

import com.fox.main.controller.DataController;
import com.fox.main.model.CRM;
import com.fox.main.model.DataFetcher;
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

import java.util.List;

@SpringBootTest
class MainApplicationTests {
	Gson gson = new GsonBuilder().create();

	@Test
	void dataFetcher() {
		String expectedData = "[{\"errorCode\":324,\"provider\":6111,\"products\":[\"BLUE\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":1,\"customerId\":818591,\"provider\":6111,\"errorCode\":324,\"status\":\"CLOSED\",\"creationDate\":\"3/14/2019 16:30\",\"modificationDate\":\"3/17/2019 03:41\",\"product\":\"BLUE\"}]},{\"errorCode\":0,\"provider\":26241,\"products\":[\"BLUE\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":2,\"customerId\":790521,\"provider\":26241,\"errorCode\":0,\"status\":\"CLOSED\",\"creationDate\":\"3/4/2019 09:30\",\"modificationDate\":\"3/5/2019 02:47\",\"product\":\"BLUE\"}]},{\"errorCode\":101,\"provider\":1211,\"products\":[\"BLUE\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":3,\"customerId\":738081,\"provider\":1211,\"errorCode\":101,\"status\":\"CLOSED\",\"creationDate\":\"2/5/2019 00:30\",\"modificationDate\":\"2/10/2019 01:52\",\"product\":\"BLUE\"}]},{\"errorCode\":101,\"provider\":10416,\"products\":[\"BLUE\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":4,\"customerId\":729841,\"provider\":10416,\"errorCode\":101,\"status\":\"CLOSED\",\"creationDate\":\"1/31/2019 06:31\",\"modificationDate\":\"2/3/2019 11:42\",\"product\":\"BLUE\"}]},{\"errorCode\":324,\"provider\":11016,\"products\":[\"BLUE\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":5,\"customerId\":827331,\"provider\":11016,\"errorCode\":324,\"status\":\"CLOSED\",\"creationDate\":\"3/19/2019 15:30\",\"modificationDate\":\"3/21/2019 08:54\",\"product\":\"BLUE\"}]},{\"errorCode\":108,\"provider\":2811,\"products\":[\"BLUE\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":6,\"customerId\":831011,\"provider\":2811,\"errorCode\":108,\"status\":\"CLOSED\",\"creationDate\":\"3/21/2019 06:33\",\"modificationDate\":\"3/21/2019 10:35\",\"product\":\"BLUE\"}]},{\"errorCode\":101,\"provider\":12,\"products\":[\"BLUE\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":7,\"customerId\":831071,\"provider\":12,\"errorCode\":101,\"status\":\"CLOSED\",\"creationDate\":\"3/21/2019 07:31\",\"modificationDate\":\"3/21/2019 23:35\",\"product\":\"BLUE\"}]},{\"errorCode\":101,\"provider\":10896,\"products\":[\"BLUE\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":8,\"customerId\":831831,\"provider\":10896,\"errorCode\":101,\"status\":\"CLOSED\",\"creationDate\":\"3/21/2019 14:32\",\"modificationDate\":\"3/21/2019 16:35\",\"product\":\"BLUE\"}]},{\"errorCode\":195,\"provider\":18121,\"products\":[\"BLUE\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":9,\"customerId\":792661,\"provider\":18121,\"errorCode\":195,\"status\":\"CLOSED\",\"creationDate\":\"3/4/2019 15:32\",\"modificationDate\":\"3/4/2019 23:54\",\"product\":\"BLUE\"}]},{\"errorCode\":103,\"provider\":11990,\"products\":[\"BLUE\"],\"openCasesCount\":1,\"cases\":[{\"caseId\":10,\"customerId\":723441,\"provider\":11990,\"errorCode\":103,\"status\":\"OPEN\",\"creationDate\":\"1/28/2019 15:30\",\"modificationDate\":\"1/29/2019 06:07\",\"product\":\"BLUE\"}]},{\"errorCode\":101,\"provider\":10001121,\"products\":[\"RED\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":1,\"customerId\":818591,\"provider\":10001121,\"errorCode\":101,\"status\":\"CLOSED\",\"creationDate\":\"4/1/2019 17:25\",\"modificationDate\":\"4/2/2019 08:00\",\"product\":\"RED\"}]},{\"errorCode\":108,\"provider\":11196,\"products\":[\"GREEN\"],\"openCasesCount\":0,\"cases\":[{\"caseId\":2,\"customerId\":790521,\"provider\":11196,\"errorCode\":108,\"status\":\"CLOSED\",\"creationDate\":\"3/22/2019 14:33\",\"modificationDate\":\"3/23/2019 23:00\",\"product\":\"GREEN\"}]}]";
		String data = gson.toJson(DataFetcher.fetch(List.of(CRM.BANANA, CRM.STRAWBERRY)));
		assert data.equals(expectedData);
	}

	@Test
	void dataController() {
		String expectedHtml = "<html><body><table style=\"width:100%\"><tr><th>Error code</th><th>Provider</th><th>Product</th><th>Number of support cases</th><th>List of all support cases</th></tr><tr><td>324</td><td>6111</td><td><div>BLUE</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>1</td><td>3/14/2019 16:30</td><td>CLOSED</td><td>818591</td><td>2465days</td><td>-</td></table></td></tr><tr><td>0</td><td>26241</td><td><div>BLUE</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>2</td><td>3/4/2019 09:30</td><td>CLOSED</td><td>790521</td><td>720days</td><td>-</td></table></td></tr><tr><td>101</td><td>1211</td><td><div>BLUE</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>3</td><td>2/5/2019 00:30</td><td>CLOSED</td><td>738081</td><td>5056days</td><td>-</td></table></td></tr><tr><td>101</td><td>10416</td><td><div>BLUE</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>4</td><td>1/31/2019 06:31</td><td>CLOSED</td><td>729841</td><td>3215days</td><td>-</td></table></td></tr><tr><td>324</td><td>11016</td><td><div>BLUE</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>5</td><td>3/19/2019 15:30</td><td>CLOSED</td><td>827331</td><td>1725days</td><td>-</td></table></td></tr><tr><td>108</td><td>2811</td><td><div>BLUE</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>6</td><td>3/21/2019 06:33</td><td>CLOSED</td><td>831011</td><td>168days</td><td>-</td></table></td></tr><tr><td>101</td><td>12</td><td><div>BLUE</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>7</td><td>3/21/2019 07:31</td><td>CLOSED</td><td>831071</td><td>669days</td><td>-</td></table></td></tr><tr><td>101</td><td>10896</td><td><div>BLUE</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>8</td><td>3/21/2019 14:32</td><td>CLOSED</td><td>831831</td><td>85days</td><td>-</td></table></td></tr><tr><td>195</td><td>18121</td><td><div>BLUE</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>9</td><td>3/4/2019 15:32</td><td>CLOSED</td><td>792661</td><td>348days</td><td>-</td></table></td></tr><tr><td>103</td><td>11990</td><td><div>BLUE</div></td><td>1</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>10</td><td>1/28/2019 15:30</td><td>OPEN</td><td>723441</td><td>-</td><td>700357days</td></table></td></tr><tr><td>101</td><td>10001121</td><td><div>RED</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>1</td><td>4/1/2019 17:25</td><td>CLOSED</td><td>818591</td><td>607days</td><td>-</td></table></td></tr><tr><td>108</td><td>11196</td><td><div>GREEN</div></td><td>0</td><td><table><tr><th>Case ID</th><th>Created at</th><th>Status</th><th>Customer ID</th><th>Time to close</th><th>Time since modified</th></tr><tr><td>2</td><td>3/22/2019 14:33</td><td>CLOSED</td><td>790521</td><td>1352days</td><td>-</td></table></td></tr></table></body></html>";
		String html = new DataController().getAggregatedCases();
		assert html.equals(expectedHtml);
	}

}
